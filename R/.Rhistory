as.numeric(gsub(".*?([0-9]+).*", "\\1"))) %>%
mutate(date = stringr::str_split(Comment, "\r") %>%
map_chr(., 3) %>%
str_sub(.,6)) %>%
filter(site != "Lbl: PC85 RAPIDFIRE PRO") %>%
select(-Comment)
exif_comment %>%
filter(!is.na(Comment)) %>%
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14) %>%
str_sub(.,6) %>%
extract_numeric()) %>%
mutate(date = stringr::str_split(Comment, "\r") %>%
map_chr(., 3) %>%
str_sub(.,6)) %>%
filter(site != "Lbl: PC85 RAPIDFIRE PRO") %>%
select(-Comment)
exif_comment %>%
filter(!is.na(Comment)) %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14) %>%
str_sub(.,6) %>%
extract_numeric()) %>%
# Date
mutate(date = stringr::str_split(Comment, "\r") %>%
map_chr(., 3) %>%
str_sub(.,6),
lubridate::parse_date_time2(., '%y-%m-%d %I:%M:%S %p')) %>%
filter(site != "Lbl: PC85 RAPIDFIRE PRO") %>%
select(-Comment)
exif_comment %>%
filter(!is.na(Comment)) %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14) %>%
str_sub(.,6) %>%
extract_numeric()) %>%
# Date
mutate(date = stringr::str_split(Comment, "\r") %>%
map_chr(., 3) %>%
str_sub(.,6),
lubridate::parse_date_time(., '%y-%m-%d %I:%M:%S %p')) %>%
filter(site != "Lbl: PC85 RAPIDFIRE PRO") %>%
select(-Comment)
exif_comment %>%
filter(!is.na(Comment)) %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14) %>%
str_sub(.,6) %>%
parse_numeric()) %>%
# Date
mutate(date = stringr::str_split(Comment, "\r") %>%
map_chr(., 3) %>%
str_sub(.,6),
lubridate::parse_date_time(., '%y-%m-%d %H:%M:%S %p')) %>%
filter(site != "Lbl: PC85 RAPIDFIRE PRO") %>%
select(-Comment)
exif_comment %>%
filter(!is.na(Comment)) %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14) %>%
str_sub(.,6) %>%
extract_numeric()) %>%
# Date
mutate(date = stringr::str_split(Comment, "\r") %>%
map_chr(., 3) %>%
str_sub(.,6),
lubridate::parse_date_time(., '%y-%m-%d %H:%M:%S %p')) %>%
filter(site != "Lbl: PC85 RAPIDFIRE PRO") %>%
select(-Comment)
exif_comment %>%
filter(!is.na(Comment)) %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14) %>%
str_sub(.,6) %>%
extract_numeric()) %>%
# Date
mutate(date = stringr::str_split(Comment, "\r") %>%
map_chr(., 3) %>%
str_sub(.,6,-1) %>%
lubridate::parse_date_time(., '%y-%m-%d %H:%M:%S %p')) %>%
filter(site != "Lbl: PC85 RAPIDFIRE PRO") %>%
select(-Comment)
exif_comment %>%
filter(!is.na(Comment)) %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14) %>%
str_sub(.,6) %>%
extract_numeric()) %>%
# Date
mutate(date = stringr::str_split(Comment, "\r") %>%
map_chr(., 3) %>%
str_sub(.,6,-1) %>%
lubridate::parse_date_time(., '%y-%m-%d %I:%M:%S %p')) %>%
filter(site != "Lbl: PC85 RAPIDFIRE PRO") %>%
select(-Comment)
exif_comment %>%
filter(!is.na(Comment)) %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14) %>%
str_sub(.,6) %>%
parse_numeric()) %>%
# Date
mutate(date = stringr::str_split(Comment, "\r") %>%
map_chr(., 3) %>%
str_sub(.,6,-1) %>%
lubridate::parse_date_time(., '%y-%m-%d %I:%M:%S %p')) %>%
filter(site != "Lbl: PC85 RAPIDFIRE PRO") %>%
select(-Comment)
exif_comment %>%
filter(!is.na(Comment)) %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14) %>%
str_sub(.,6) %>%
parse_number()) %>%
# Date
mutate(date = stringr::str_split(Comment, "\r") %>%
map_chr(., 3) %>%
str_sub(.,6,-1) %>%
lubridate::parse_date_time(., '%y-%m-%d %I:%M:%S %p')) %>%
filter(site != "Lbl: PC85 RAPIDFIRE PRO") %>%
select(-Comment)
exif
exif %>%
select(SourceFile)
exif %>%
select(Directory)
files
df
df %>%
bind_cols(exif$UserLabel, exif$Comment)
names(exif)
exif$FileName
exif %>%
select(Directory, Filename, UserLabel, Comment)
exif %>%
select(Directory, FileName, UserLabel, Comment)
exif %>%
filter(!is.na(UserLabel) & !is.na(Comment))
exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO")) %>%
df %>%
bind_cols(exif$UserLabel, exif$Comment)
exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))
exif_no_ul <- exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14) %>%
str_sub(.,6) %>%
parse_number()) %>%
# Date
mutate(date = stringr::str_split(Comment, "\r") %>%
map_chr(., 3) %>%
str_sub(.,6,-1) %>%
lubridate::parse_date_time(., '%y-%m-%d %I:%M:%S %p')) %>%
filter(site != "Lbl: PC85 RAPIDFIRE PRO") %>%
select(-Comment)
exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14) %>%
str_sub(.,6) %>%
parse_number()) %>%
# Date
mutate(date = stringr::str_split(Comment, "\r") %>%
map_chr(., 3) %>%
str_sub(.,6,-1) %>%
lubridate::parse_date_time(., '%y-%m-%d %I:%M:%S %p')) %>%
filter(site != "Lbl: PC85 RAPIDFIRE PRO") %>%
select(-Comment)
exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))
exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14) %>%
str_sub(.,6) %>%
parse_number())
exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14))
exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r"))
exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r"))
exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14))
# drop images where site info is not avaiable
exif_comment <- exif %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO")) %>%
select(Comment)
exif_comment %>%
filter(!is.na(Comment)) %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14) %>%
str_sub(.,6) %>%
parse_number()) %>%
# Date
mutate(date = stringr::str_split(Comment, "\r") %>%
map_chr(., 3) %>%
str_sub(.,6,-1) %>%
lubridate::parse_date_time(., '%y-%m-%d %I:%M:%S %p')) %>%
filter(site != "Lbl: PC85 RAPIDFIRE PRO") %>%
select(-Comment)
exif %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO")) %>%
select(Comment)
exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
filter(!is.na(Comment))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14))
exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
filter(!is.na(Comment))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14) %>%
str_sub(.,6) %>%
parse_number()) %>%
# Date
mutate(date = stringr::str_split(Comment, "\r") %>%
map_chr(., 3) %>%
str_sub(.,6,-1) %>%
lubridate::parse_date_time(., '%y-%m-%d %I:%M:%S %p'))
exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
filter(!is.na(Comment))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14) %>%
str_sub(.,6) %>%
filter(!., str_detect("RAPIDFIRE")) %>%
parse_number())
exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
filter(!is.na(Comment))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14) %>%
str_sub(.,6) %>%
filter(!str_detect("RAPIDFIRE")) %>%
parse_number())
exif_no_ul <- exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
filter(!is.na(Comment))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14) %>%
str_sub(.,6))
unique(exif_no_ul$site)
exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
filter(!is.na(Comment))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>%
map_chr(., 14) %>%
str_sub(.,6)) %>%
filter(!str_detect(.,"RAPIDFIRE")) %>%
parse_number())
exif_no_ul <- exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
filter(!is.na(Comment))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>% map_chr(., 14) %>% str_sub(.,6))
unique(exif_no_ul$site)
exif_no_ul <- exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
filter(!is.na(Comment))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>% map_chr(., 14) %>% str_sub(.,6)) %>%
filter(!str_detect(site,"RAPIDFIRE"))
unique(exif_no_ul$site)
exif_no_ul <- exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
filter(!is.na(Comment))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>% map_chr(., 14) %>% str_sub(.,6)) %>%
filter(!str_detect(site,"RAPIDFIRE")) %>%
mutate(site = parse_number())
exif_no_ul <- exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
filter(!is.na(Comment))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>% map_chr(., 14) %>% str_sub(.,6)) %>%
filter(!str_detect(site,"RAPIDFIRE")) %>%
mutate(site = parse_number(site))
unique(exif_no_ul$site)
exif_no_ul <- exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
filter(!is.na(Comment))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>% map_chr(., 14) %>% str_sub(.,6)) %>%
filter(!str_detect(site,"RAPIDFIRE")) %>%
mutate(site = parse_number(site)) %>%
# Date
mutate(date = stringr::str_split(Comment, "\r") %>%
map_chr(., 3) %>%
str_sub(.,6,-1) %>%
lubridate::parse_date_time(., '%y-%m-%d %I:%M:%S %p')) %>%
filter(site != "Lbl: PC85 RAPIDFIRE PRO") %>%
select(-Comment)
unique(exif_no_ul$site)
exif_ul <- exif %>%
select(Directory, FileName, UserLabel, ) %>%
names(exif)
names(exif)
exif %>%
select(Directory, FileName, UserLabel, CreateDate)
exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel))
x <- exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel))
unique(x$UserLabel)
x <- exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel) | !str_detect(UserLabel, "RAPIDFIRE"))
unique(x$UserLabel)
x <- exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel) & !str_detect(UserLabel, "RAPIDFIRE"))
unique(x$UserLabel)
x <- exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel)) %>%
filter(!str_detect(UserLabel, "RAPIDFIRE"))
unique(x$UserLabel)
x <- exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel)) %>%
filter(!str_detect(x$UserLabel, "RAPIDFIRE"))
unique(x$UserLabel)
str_detect(x$UserLabel, "RAPIDFIRE")
x <- exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel)) %>%
filter(!str_detect(x$UserLabel, "PC"))
unique(x$UserLabel)
x <- exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel)| !str_detect(x$UserLabel, "PC"))
x <- exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel)| !str_detect(UserLabel, "PC"))
unique(x$UserLabel)
x <- exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel) & !str_detect(UserLabel, "PC"))
unique(x$UserLabel)
exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel) & !str_detect(UserLabel, "PC"))
x <- exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel) & !str_detect(UserLabel, "PC")) %>%
mutate(site = parse_number(UserLabel),
date = lubridate::parse_date_time(CreateDate, '%Y:%m:%d %H:%M:%s'))
x <- exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel) & !str_detect(UserLabel, "PC")) %>%
mutate(site = parse_number(UserLabel),
date = lubridate::parse_date_time(CreateDate, '%Y:%m:%d %H:%M:%s')) %>%
select(site, date)
x
x <- exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel) & !str_detect(UserLabel, "PC")) %>%
mutate(site = parse_number(UserLabel),
date = lubridate::parse_date_time(CreateDate, '%Y:%m:%d %H:%M:%s')) %>%
select(site, date, Directory, Filename)
x <- exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel) & !str_detect(UserLabel, "PC")) %>%
mutate(site = parse_number(UserLabel),
date = lubridate::parse_date_time(CreateDate, '%Y:%m:%d %H:%M:%s')) %>%
select(site, date, Directory, FileName)
x
exif_ul <- exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel) & !str_detect(UserLabel, "PC")) %>%
mutate(site = parse_number(UserLabel),
date = lubridate::parse_date_time(CreateDate, '%Y:%m:%d %H:%M:%s')) %>%
select(site, date, Directory, FileName)
exif_ul
exif_no_ul
exif_ul <- exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel) & !str_detect(UserLabel, "PC")) %>%
mutate(site = parse_number(UserLabel),
date = lubridate::parse_date_time(CreateDate, '%Y:%m:%d %H:%M:%s')) %>%
select(Directory, FileName, site, date)
exif_no_ul
exif_no_ul <- exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
filter(!is.na(Comment))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>% map_chr(., 14) %>% str_sub(.,6)) %>%
filter(!str_detect(site,"RAPIDFIRE")) %>%
mutate(site = parse_number(site)) %>%
# Date
mutate(date = stringr::str_split(Comment, "\r") %>%
map_chr(., 3) %>%
str_sub(.,6,-1) %>%
lubridate::parse_date_time(., '%y-%m-%d %I:%M:%S %p')) %>%
filter(site != "Lbl: PC85 RAPIDFIRE PRO") %>%
select(-Comment, UserLabel)
exif_ul <- exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel) & !str_detect(UserLabel, "PC")) %>%
mutate(site = parse_number(UserLabel),
date = lubridate::parse_date_time(CreateDate, '%Y:%m:%d %H:%M:%s')) %>%
select(Directory, FileName, site, date)
exif_no_ul
exif_ul
exif_no_ul
exif_no_ul <- exif %>%
select(Directory, FileName, UserLabel, Comment) %>%
filter(UserLabel %in% c("NA",NA, "PC800 HYPERFIRE PRO"))  %>%
filter(!is.na(Comment))  %>%
# Site
mutate(site = stringr::str_split(Comment, "\r") %>% map_chr(., 14) %>% str_sub(.,6)) %>%
filter(!str_detect(site,"RAPIDFIRE")) %>%
mutate(site = parse_number(site)) %>%
# Date
mutate(date = stringr::str_split(Comment, "\r") %>%
map_chr(., 3) %>%
str_sub(.,6,-1) %>%
lubridate::parse_date_time(., '%y-%m-%d %I:%M:%S %p')) %>%
filter(site != "Lbl: PC85 RAPIDFIRE PRO") %>%
select(-Comment, -UserLabel)
exif_ul <- exif %>%
select(Directory, FileName, UserLabel, CreateDate) %>%
filter(!is.na(UserLabel) & !str_detect(UserLabel, "PC")) %>%
mutate(site = parse_number(UserLabel),
date = lubridate::parse_date_time(CreateDate, '%Y:%m:%d %H:%M:%s')) %>%
select(Directory, FileName, site, date)
exif_ul
exif_no_ul
bind_rows(exif_ul,exif_no_ul)
meta <- bind_rows(exif_ul,exif_no_ul)
df
df <- df %>% filter(adults != "unk") %>%
mutate(source = paste0(path,image))
df
bind_rows(exif_ul,exif_no_ul)
meta <- bind_rows(exif_ul,exif_no_ul) %>%
mutate(source = paste0(Directory,"/", FileName)) %>%
select(-Directory,FileName)
meta
meta <- bind_rows(exif_ul,exif_no_ul) %>%
mutate(source = paste0(Directory,"/", FileName)) %>%
select(-Directory,-FileName)
meta
df
meta <- bind_rows(exif_ul,exif_no_ul) %>%
mutate(source = paste0(Directory,"/", FileName)) %>%
select(-Directory,-FileName) %>%
right_join(df, by = "source")
meta
meta <- bind_rows(exif_ul,exif_no_ul) %>%
mutate(source = paste0(Directory,"/", FileName)) %>%
select(-Directory,-FileName) %>%
right_join(df, by = "source") %>%
select(-path, -image)
meta
predictions <- arrow::read_parquet("data/02_alldata_2016.parquet")
